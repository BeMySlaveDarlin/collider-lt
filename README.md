# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Collider —Å k6

## üîÑ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù—é–∞–Ω—Å—ã API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- **GET /users/{user_id}/events** - –ª–∏–º–∏—Ç –≤—Å–µ–≥–¥–∞ 1000 (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)
- **GET /stats** - —Å–∞–º—ã–π —Ç—è–∂–µ–ª—ã–π –∑–∞–ø—Ä–æ—Å, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–µ—à–∞
- **–î–∞–Ω–Ω—ã–µ –∏–∑ CSV** - –∑–∞–≥—Ä—É–∑–∫–∞ users.csv –∏ event_types.csv

### –õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è stats:
3. **–ö–µ—à —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ—Ç–¥–µ–ª—å–Ω–æ —Å –∫–µ—à–µ–º –∏ –±–µ–∑ –∫–µ—à–∞ –¥–ª—è /stats
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - —Å–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ—Å–ª–µ POST

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Collider —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º k6. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å —É—á–µ—Ç–æ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è GET –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–±—Ä–æ—Å–∞ –∫–µ—à–∞ –ø–æ—Å–ª–µ POST/DELETE –æ–ø–µ—Ä–∞—Ü–∏–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
k6-tests/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ scenarios.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ thresholds.js         # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ data/                     # CSV –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ users.csv             # 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (ID 1-1000)
‚îÇ   ‚îî‚îÄ‚îÄ event_types.csv       # 100 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π (ID 1-100)
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ scenario-load-create.js      # Load test: Create (RPS)
‚îÇ   ‚îú‚îÄ‚îÄ scenario-load-read.js        # Load test: Read (RPS)
‚îÇ   ‚îú‚îÄ‚îÄ scenario-create-read.js      # Load test: Create/Read (RPS)
‚îÇ   ‚îú‚îÄ‚îÄ scenario-stats-cache.js      # Load test: Stats —Å –∫–µ—à–µ–º –∏ –±–µ–∑
‚îÇ   ‚îî‚îÄ‚îÄ scenario-score.js            # Load test (score)
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ helpers.js            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ data-loader.js        # –ó–∞–≥—Ä—É–∑—á–∏–∫ CSV –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ results/                  # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ run-all-tests.sh         # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–û–ë–ù–û–í–õ–ï–ù)
‚îú‚îÄ‚îÄ quick-test.sh            # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API
‚îî‚îÄ‚îÄ monitor-resources.sh     # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```

## üîç API –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º

### üìù **POST /event** - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
```json
{
  "user_id": 1-1000,
  "event_type": "click|page_view|scroll|...",
  "timestamp": "2025-06-15T10:30:00Z",
  "metadata": {"page": "/home", "referrer": "..."}
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–µ—à –¥–ª—è –≤—Å–µ—Ö GET –∑–∞–ø—Ä–æ—Å–æ–≤

### üìñ **GET /events** - –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
```
GET /events?page=1&limit=100
```
**–ö–µ—à–∏—Ä—É–µ—Ç—Å—è**: ‚úî –ë—ã—Å—Ç—Ä–µ–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### üë§ **GET /users/{user_id}/events** - –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
GET /users/123/events?limit=1000
```
**–ö–µ—à–∏—Ä—É–µ—Ç—Å—è**: ‚úî **–õ–∏–º–∏—Ç –≤—Å–µ–≥–¥–∞ 1000** (–∏–∑–º–µ–Ω–µ–Ω–∏–µ!)

### üìä **GET /stats** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–¢–Ø–ñ–ï–õ–´–ô)
```
GET /stats?from=2025-01-01&to=2025-12-31&type=click&limit=5
```
**–ö–µ—à–∏—Ä—É–µ—Ç—Å—è**: ‚úî –°–∞–º—ã–π —Ç—è–∂–µ–ª—ã–π –∑–∞–ø—Ä–æ—Å, –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–µ—à–∞

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ k6
```bash
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update && sudo apt-get install k6
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
mkdir -p ~/k6-tests/{config,tests,utils,results,data}
cd ~/k6-tests

# CSV —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ run-all-tests.sh
# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é:
# data/users.csv - 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# data/event_types.csv - 100 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
```

### 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./quick-test.sh http://localhost

# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–û–ë–ù–û–í–õ–ï–ù–û)
./run-all-tests.sh http://localhost
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. Load test: Create (RPS)
```bash
k6 run --env BASE_URL=http://localhost tests/scenario-load-create.js
```
- **–¶–µ–ª—å**: 100+ RPS —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π POST —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–µ—à

### 2. Load test: Read (RPS)
```bash
k6 run --env BASE_URL=http://localhost tests/scenario-load-read.js
```
- **–¢–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã**: `/events`, `/users/{id}/events?limit=1000`, `/stats`
- **–¶–µ–ª—å**: 160+ RPS —á—Ç–µ–Ω–∏—è
- **–ö–µ—à –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∫–µ—à–∞

### 3. Load test: Create/Read (RPS)
```bash
k6 run --env BASE_URL=http://localhost tests/scenario-create-read.js
```
- **–ë–µ–∑ DELETE**: 30% —Å–æ–∑–¥–∞–Ω–∏–µ, 70% —á—Ç–µ–Ω–∏–µ
- **–¶–µ–ª—å**: 150+ RPS –æ–±—â–∏–π
- **–°–±—Ä–æ—Å –∫–µ—à–∞**: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ POST

### 4. Load test: Stats Cache
```bash
k6 run --env BASE_URL=http://localhost tests/scenario-stats-cache.js
```
- **–° –∫–µ—à–µ–º**: –¢–æ–ª—å–∫–æ GET /stats (–±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã)
- **–ë–µ–∑ –∫–µ—à–∞**: POST + GET /stats (–º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ù–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

### 5. Load test (score)
```bash
k6 run --env BASE_URL=http://localhost tests/scenario-score.js
```
- **–°–∫–æ—Ä–∏–Ω–≥**: A+ (90+), A (80+), B (70+), C (60+), D (<60)

### GET /users/{id}/events
- üîÑ **–õ–∏–º–∏—Ç –≤—Å–µ–≥–¥–∞ 1000** –≤–º–µ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- üë§ **User ID**: –ò–∑ CSV —Ñ–∞–π–ª–∞ –∏–ª–∏ 1-1000

### GET /stats —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- üöÄ **–° –∫–µ—à–µ–º**: –¢–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã, –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
- üêå **–ë–µ–∑ –∫–µ—à–∞**: POST –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º GET, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- üìä **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ top_pages

### CSV –¥–∞–Ω–Ω—ã–µ
- üë• **users.csv**: 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å ID, –∏–º–µ–Ω–µ–º, email
- üìä **event_types.csv**: 100 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- üîÑ **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ**: –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑

### –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```bash
# –ö–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è /stats
cat results/stats-cache-20241215.json | jq '.metrics.cache_hits.values.count'

# DELETE –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
cat results/delete-isolated-20241215.json | jq '.metrcs.deleted_events_count.values'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
cat results/stats-cache-20241215.json | jq '.metrics.pages_verified.values'
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### –û—Ç–ª–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (A+)
- Create RPS: > 100
- Read RPS (cached): > 160
- Stats cached vs uncached: > 5x —Ä–∞–∑–Ω–∏—Ü–∞
- DELETE isolated: > 3 RPS

#### –ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
- –ù–∏–∑–∫–∏–π cache hit rate –¥–ª—è /stats
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ uncached –∑–∞–ø—Ä–æ—Å—ã > 2000ms
- DELETE –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–º–µ—Å—Ç–µ)

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –Ω—é–∞–Ω—Å—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úî –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DELETE –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö /stats –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úî –ü—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ POST –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úî –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å CSV –¥–∞–Ω–Ω—ã–º–∏
